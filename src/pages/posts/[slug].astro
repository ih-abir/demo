---
import TodoPostPreview from '../../layouts/TodoPostPreview.astro';

export async function getStaticPaths() {
    const GqlQuery = `{
        todoDetails {
            data{
                id
                attributes{
                    Title
                    Description
                    slug
                    Hero_image{
                        data{
                            id
                            attributes{
                                url
                                alternativeText
                            }
                        }
                    }
                    Image_blob{
                        data{
                            id
                            attributes{
                                url
                                alternativeText
                            }
                        }
                    }
                }
            }
        }
    }`;

    
    const response = await fetch(`${import.meta.env.DB_URL}`,
       {
           method:'POST',
           headers: {
             'Content-Type':'application/json',
             'Authorization': `Bearer ${import.meta.env.ACCESS_TOKEN}`
           },
           body: JSON.stringify({
             query: GqlQuery,
           })
       });

    const data = await response.json();
    const posts = data.data.todoDetails.data;


    return posts.map((post) => {
        return {
            params: {slug: post.attributes.slug},
            props: {post: post.attributes}
        };
    });
}
const {slug} = Astro.params;
const {post} = Astro.props;

---

<TodoPostPreview post={post} />
 


